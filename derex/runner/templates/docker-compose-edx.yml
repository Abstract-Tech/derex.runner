# Open edX services
version: "3"
services:
  lms:
    image: derex/openedx-ironwood:latest
    command: sh -c 'gunicorn --name $${SERVICE_VARIANT} --bind=0.0.0.0:4700 --max-requests=1000 wsgi:application'
    ports:
      - 127.0.0.1:4700:4700
    container_name: derex_lms
    depends_on:
      - rabbitmq
      - mysql
      - mongodb
      - elasticsearch

  cms:
    image: derex/openedx-ironwood:latest
    command: sh -c 'gunicorn --name $${SERVICE_VARIANT} --bind=0.0.0.0:4800 --max-requests=1000 wsgi:application'
    environment:
      SERVICE_VARIANT: cms
    ports:
      - 127.0.0.1:4800:4800
    container_name: derex_cms
    depends_on:
      - rabbitmq
      - mysql
      - mongodb
      - elasticsearch

  lms_worker:
    image: derex/openedx-ironwood:latest
    command: sh -c './manage.py $${SERVICE_VARIANT} celery worker --loglevel=info --hostname=edx.$${SERVICE_VARIANT}.core.default --maxtasksperchild 100'
    container_name: derex_lms_worker
    environment:
      C_FORCE_ROOT: "True"
    depends_on:
      - rabbitmq
      - mysql
      - mongodb
      - mailslurper
      - elasticsearch

  cms_worker:
    image: derex/openedx-ironwood:latest
    command: sh -c './manage.py $${SERVICE_VARIANT} celery worker --loglevel=info --hostname=edx.$${SERVICE_VARIANT}.core.default --maxtasksperchild 100'
    container_name: derex_cms_worker
    environment:
      C_FORCE_ROOT: "True"
      SERVICE_VARIANT: cms
    depends_on:
      - rabbitmq
      - mysql
      - mongodb
      - mailslurper
      - elasticsearch
